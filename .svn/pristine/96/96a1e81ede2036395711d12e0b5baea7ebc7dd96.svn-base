package com.vritti.vwb.vworkbench;

import android.content.Context;
import android.database.sqlite.SQLiteDatabase;
import android.os.AsyncTask;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.support.v7.widget.DefaultItemAnimator;
import android.support.v7.widget.LinearLayoutManager;
import android.support.v7.widget.RecyclerView;
import android.support.v7.widget.Toolbar;
import android.util.Log;
import android.widget.TextView;

import com.google.gson.Gson;
import com.vritti.databaselib.data.DatabaseHandlers;
import com.vritti.databaselib.other.Utility;
import com.vritti.databaselib.other.WebUrlClass;
import com.vritti.ekatm.R;
import com.vritti.sessionlib.CallbackInterface;
import com.vritti.sessionlib.StartSession;
import com.vritti.vwb.Adapter.ViewReportsAdapter;
import com.vritti.vwb.Beans.ReportsTotalCount;
import com.vritti.vwb.Beans.SelectedKendraObj;
import com.vritti.vwb.Beans.ViewReportsDT;
import com.vritti.vwb.classes.CommonFunction;

import java.util.ArrayList;

public class ViewReports extends AppCompatActivity {


    DatabaseHandlers db;
    CommonFunction cf;
    SQLiteDatabase sql;
    String PlantMasterId = "", LoginId = "", Password = "", CompanyURL = "", EnvMasterId = "",
            UserMasterId = "", UserName = "", MobileNo = "";
    Utility ut;
    Context context;
    RecyclerView list_reportDetails;
    TextView txt_total_a14, txt_total_a13;
    String finalSelectedKendraObj = "";
    ArrayList<ViewReportsDT> reportsDTS;
    ArrayList<ReportsTotalCount> totalArrayList;

    SelectedKendraObj selectedKendraObj;
    ViewReportsAdapter viewReports;


    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_view_reports);

        Toolbar toolbar_action = (Toolbar) findViewById(R.id.toolbar);
        toolbar_action.setLogo(R.mipmap.ic_toolbar_logo_vwb);
        toolbar_action.setTitle(R.string.app_name_toolbar_Vwb);
        setSupportActionBar(toolbar_action);

        context = getApplicationContext();
        ut = new Utility();
        cf = new CommonFunction(context);
        String settingKey = ut.getSharedPreference_SettingKey(context);
        String dabasename = ut.getValue(context, WebUrlClass.GET_DATABASE_NAME_KEY, settingKey);
        db = new DatabaseHandlers(context, dabasename);
        CompanyURL = ut.getValue(context, WebUrlClass.GET_COMPANY_URL_KEY, settingKey);
        EnvMasterId = ut.getValue(context, WebUrlClass.GET_EnvMasterID_KEY, settingKey);
        PlantMasterId = ut.getValue(context, WebUrlClass.GET_PlantID_KEY, settingKey);
        LoginId = ut.getValue(context, WebUrlClass.GET_LOGIN_KEY, settingKey);
        Password = ut.getValue(context, WebUrlClass.GET_PSW_KEY, settingKey);
        UserMasterId = ut.getValue(context, WebUrlClass.GET_USERMASTERID_KEY, settingKey);
        UserName = ut.getValue(context, WebUrlClass.GET_USERNAME_KEY, settingKey);
        sql = db.getWritableDatabase();
        initView();

        if (getIntent() != null) {

            finalSelectedKendraObj = getIntent().getStringExtra("response");
            reportsDTS = new Gson().fromJson(getIntent().getStringExtra("viewReports"), ViewReportsDT.class).getViewReports();
            totalArrayList = new Gson().fromJson(getIntent().getStringExtra("Total"), ReportsTotalCount.class).getTotalCount();
            //fromSchool = getIntent().getStringExtra("forSchool");
            /* Log.i("Intent Object===   ", reportsDTS);*/
            if (totalArrayList != null) {
                if (totalArrayList.size() != 0) {
                    String a13 = totalArrayList.get(0).getSum();
                    String a14 = totalArrayList.get(1).getSum();
                    txt_total_a13.setText(a13);
                    txt_total_a14.setText(a14);
                }
            }


        }

        UpdateSelectedKendra();

    }

    private void UpdateSelectedKendra() {

        viewReports = new ViewReportsAdapter(this, reportsDTS);
        RecyclerView.LayoutManager mLayoutManager = new LinearLayoutManager(getApplicationContext());
        list_reportDetails.setLayoutManager(mLayoutManager);
        list_reportDetails.setAdapter(viewReports);

    }

    private void initView() {

        list_reportDetails = findViewById(R.id.list_reportDetails);
        txt_total_a13 = findViewById(R.id.txt_total_a13);
        txt_total_a14 = findViewById(R.id.txt_total_a14);
        reportsDTS = new ArrayList<>();
    }


    class DownloadReportsDetails extends AsyncTask<String, Void, String> {

        String res = "";

        @Override
        protected void onPreExecute() {
            super.onPreExecute();
        }

        @Override
        protected String doInBackground(String... strings) {

            String url = CompanyURL + WebUrlClass.api_Viewreports;
            try {
                //  res = ut.OpenPostConnection(url,selectedKendraObj, ViewReports.this);
                //    response = res.toString().replaceAll("\\\\\\\\\\\"", "");


            } catch (Exception e) {
                e.printStackTrace();
            }
            return null;
        }

        @Override
        protected void onPostExecute(String s) {
            super.onPostExecute(s);
        }
    }
}
